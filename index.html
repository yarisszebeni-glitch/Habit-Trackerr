<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Habit Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  background:#f2f2f2;
  margin:0;
  padding:20px;
}
.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  border-radius:12px;
  padding:20px;
}

/* ===== TOP ===== */
#userStatus{font-weight:bold;margin-bottom:10px}

/* ===== VIEW SWITCH ===== */
.viewSwitch{
  display:flex;
  gap:8px;
  margin-bottom:15px;
}
.viewSwitch button{
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  background:#ddd;
}
.viewSwitch button.active{
  background:#6fa85c;
  color:#fff;
}

/* ===== WEEK VIEW ===== */
.weekHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.weekGrid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.dayCard{
  background:#fafafa;
  border-radius:10px;
  padding:10px;
  text-align:center;
}
.dayName{font-weight:bold;margin-bottom:4px}
.sleepIcon{font-size:26px;cursor:pointer}
.sleepHours{font-size:14px;margin-top:4px}

/* colors */
.red{background:#ffd6d6}
.yellow{background:#fff3c4}
.green{background:#d9f5d9}

/* ===== MONTH VIEW ===== */
.tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.tabs button{padding:6px 10px;border-radius:6px;border:none;background:#ddd}
.tabs button.active{background:#6fa85c;color:#fff}

.tableWrapper{overflow-x:auto}
table{border-collapse:collapse;width:100%;min-width:900px;font-size:12px}
th,td{border:1px solid #ddd;padding:4px;text-align:center}
th{background:#f7f7f7}
.habit{text-align:left;font-weight:bold}

.progress{height:8px;background:#ddd;border-radius:6px;overflow:hidden;margin-top:4px}
.progress div{height:100%;background:#6fa85c}

/* ===== CHART ===== */
.chartWrapper{height:300px;margin-top:30px}

@media(max-width:768px){
  .chartWrapper{height:220px}
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="container">

<h2>Habit Tracker</h2>
<div id="userStatus">Nicht eingeloggt</div>
<button id="loginBtn">Login</button>
<button id="logoutBtn">Logout</button>

<hr>

<div class="viewSwitch">
  <button id="weekBtn" class="active">Wochenansicht üò¥</button>
  <button id="monthBtn">Monatsansicht üìÖ</button>
</div>

<!-- ===== WEEK VIEW ===== -->
<div id="weekView">
  <div class="weekHeader">
    <button onclick="changeWeek(-1)">‚¨ÖÔ∏è</button>
    <b id="weekLabel"></b>
    <button onclick="changeWeek(1)">‚û°Ô∏è</button>
  </div>
  <div class="weekGrid" id="weekGrid"></div>
</div>

<!-- ===== MONTH VIEW ===== -->
<div id="monthView" style="display:none">

<b>Jahr:</b>
<select id="yearSelect"></select>
<div class="tabs" id="months"></div>

<br>
<input id="habitInput" placeholder="Neuer Habit">
<input id="goalInput" type="number" placeholder="Ziel (Tage)">
<button onclick="addHabit()">Hinzuf√ºgen</button>

<br><br>
<div class="tableWrapper">
  <table id="table"></table>
</div>

<div class="chartWrapper">
  <canvas id="monthChart"></canvas>
</div>

</div>
</div>

<script type="module">
/* ===== FIREBASE ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCkWCxlVJGoNbXG7jHQ-KKgRrKtamQb6B0",
  authDomain: "habit-tracker-71caa.firebaseapp.com",
  projectId: "habit-tracker-71caa",
  storageBucket: "habit-tracker-71caa.appspot.com",
  messagingSenderId: "512623329438",
  appId: "1:512623329438:web:b678351963b85e17d23b8f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

/* ===== DATA ===== */
let data={habits:{},logs:{},sleep:{}};
let currentWeekOffset=0;
const sleepGoal=8;

/* ===== AUTH ===== */
loginBtn.onclick=()=>signInWithPopup(auth,provider);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,async user=>{
  if(!user){userStatus.textContent="Nicht eingeloggt";return;}
  userStatus.textContent="Eingeloggt als "+user.email;
  const snap=await getDoc(doc(db,"users",user.uid));
  if(snap.exists()) data=snap.data();
  else await save();
  renderWeek();
});

/* ===== SAVE ===== */
async function save(){
  if(!auth.currentUser)return;
  await setDoc(doc(db,"users",auth.currentUser.uid),data);
}

/* ===== VIEW SWITCH ===== */
weekBtn.onclick=()=>{
  weekBtn.classList.add("active");
  monthBtn.classList.remove("active");
  weekView.style.display="block";
  monthView.style.display="none";
};
monthBtn.onclick=()=>{
  monthBtn.classList.add("active");
  weekBtn.classList.remove("active");
  monthView.style.display="block";
  weekView.style.display="none";
};

/* ===== WEEK LOGIC ===== */
function changeWeek(dir){
  currentWeekOffset+=dir;
  renderWeek();
}

function renderWeek(){
  weekGrid.innerHTML="";
  const start=new Date();
  start.setDate(start.getDate()-start.getDay()+1+currentWeekOffset*7);

  weekLabel.textContent=`${start.toLocaleDateString()}`;

  for(let i=0;i<7;i++){
    const d=new Date(start);
    d.setDate(start.getDate()+i);
    const key=d.toISOString().slice(0,10);

    data.sleep[key] ??= {hours:0};

    const h=data.sleep[key].hours;
    let cls=h>=sleepGoal?"green":h>=6?"yellow":h>0?"red":"";

    weekGrid.innerHTML+=`
      <div class="dayCard ${cls}">
        <div class="dayName">${d.toLocaleDateString("de",{weekday:"short"})}</div>
        <div class="sleepIcon" onclick="setSleep('${key}')">üò¥</div>
        <div class="sleepHours">${h?h+" h":"-"}</div>
      </div>`;
  }
}

window.setSleep=(key)=>{
  const h=parseFloat(prompt("Schlafstunden eingeben:","8"));
  if(isNaN(h))return;
  data.sleep[key]={hours:h};
  save();
  renderWeek();
};
</script>
</body>
</html>










